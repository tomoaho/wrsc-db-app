<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ match_name }} å¹´åº¦ä¸€è¦§ - å°„æ’ƒéƒ¨DB</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body>
    <header class="site-header">
        <div class="header-left">
            <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
            <a href="{{ url_for('index') }}" class="header-logo"><span>ğŸ¯ å°„æ’ƒéƒ¨DB</span></a>
        </div>
    </header>

    <nav class="site-sidebar" id="sidebar">
        <div style="padding: 20px; font-weight: bold; font-size: 1.2em; border-bottom: 1px solid rgba(255,255,255,0.1);">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
        <a href="{{ url_for('index') }}" class="sidebar-link">ğŸ  ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸</a>
        <a href="{{ url_for('ranking') }}" class="sidebar-link">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        <a href="{{ url_for('matches') }}" class="sidebar-link">ğŸ“… å¤§ä¼šè¨˜éŒ²</a>
        <a href="https://waseda-shooting.com/" target="_blank" class="sidebar-link">ğŸ”— å°„æ’ƒéƒ¨HP</a>
    </nav>
    <div class="sidebar-overlay" id="overlay" onclick="toggleSidebar()"></div>

    <div class="container">
        <a href="{{ url_for('matches') }}">â† å¤§ä¼šé¸æŠã«æˆ»ã‚‹</a>
        <h1>{{ match_name }}</h1>
        
        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">
                <h3 style="margin: 0;">ğŸ“ˆ å›£ä½“å¾—ç‚¹æ¨ç§» (Regular)</h3>
            </div>

            <div class="graph-tabs">
                <button class="graph-tab-btn active" data-event="AR60" onclick="updateMatchYearsChart('AR60')">AR60</button>
                <button class="graph-tab-btn" data-event="SB3x20" onclick="updateMatchYearsChart('SB3x20')">SB3x20</button>
                <button class="graph-tab-btn" data-event="P60" onclick="updateMatchYearsChart('P60')">P60</button>
            </div>

            <div class="match-chart-wrapper">
                <canvas id="teamTrendChart"></canvas>
            </div>
        </div>

        <p>é–²è¦§ã—ãŸã„é–‹å‚¬å¹´åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>

        <table class="score-table">
            <thead>
                <tr>
                    <th>é–‹å‚¬å¹´åº¦</th>
                    <th>é–‹å‚¬æ—¥</th>
                    <th>å›£ä½“ãƒ¡ãƒ³ãƒãƒ¼ (Regular)</th>
                    <th>è©³ç´°</th>
                </tr>
            </thead>
            <tbody>
                {% for year, data in years_data %}
                <tr>
                    <td style="font-weight: bold; font-size: 1.1em;">{{ year }}å¹´åº¦</td>
                    <td style="white-space: nowrap;">
                        {% if data.start_date == data.end_date %}
                            {{ data.start_date }}
                        {% else %}
                            {{ data.start_date }} <span style="color: #999;">ã€œ</span><br>
                            {{ data.end_date }}
                        {% endif %}
                    </td>
                    <td style="text-align: left; font-size: 0.9em; line-height: 1.6;">
                        {% if data.regulars %}
                            {% if 'æ—©æ…¶æˆ¦' in match_name %}
                                {% set target_keys = ['AR60', 'SB3x20', 'P60'] %}
                                {% for key in target_keys %}
                                    {% if key in data.regulars %}
                                    <div>
                                        {% set badge_cls = 'badge-default' %}
                                        {% if 'AR60' in key %} {% set badge_cls = 'badge-AR60' %}
                                        {% elif 'SB3x20' in key %} {% set badge_cls = 'badge-SB3x20' %}
                                        {% elif 'P60' in key %} {% set badge_cls = 'badge-P60' %}
                                        {% endif %}
                                        <span class="event-badge {{ badge_cls }}">{{ key }}</span>
                                        {{ data.regulars[key]|join(', ') }}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% set target_keys = ['AR60 ç”·', 'AR60 å¥³', 'SB3x20 ç”·', 'SB3x20 å¥³'] %}
                                {% for key in target_keys %}
                                    {% if key in data.regulars %}
                                    <div>
                                        {% set badge_cls = 'badge-default' %}
                                        {% if 'AR60' in key %} {% set badge_cls = 'badge-AR60' %}
                                        {% elif 'SB3x20' in key %} {% set badge_cls = 'badge-SB3x20' %}
                                        {% endif %}
                                        <span class="event-badge {{ badge_cls }}">{{ key }}</span>
                                        {{ data.regulars[key]|join(', ') }}
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% else %}
                            <span style="color: #999;">å›£ä½“å‡ºå ´ãªã—</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('match_result', match_name=match_name, year=year) }}" class="btn-detail" style="background-color: #007bff;">
                            çµæœã‚’è¦‹ã‚‹
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        // Pythonã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
        const matchYearsLabels = {{ chart_labels | tojson }};
        const matchYearsDatasets = {{ chart_datasets | tojson }};

        // ã‚°ãƒ©ãƒ•åˆæœŸåŒ– (script.js)
        if (matchYearsDatasets && matchYearsDatasets.length > 0) {
            initMatchYearsChart(matchYearsLabels, matchYearsDatasets);
        }
    </script>
</body>
</html>